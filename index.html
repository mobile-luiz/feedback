<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Feedback | Diffs e Ocorr√™ncias da Qualidade</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --shoppe-red: #e53935;
      --shoppe-red-light: #ff5252;
      --shoppe-orange: #ff6f00;
      --shoppe-orange-light: #ff9100;
      --shoppe-dark: #212121;
      --shoppe-gray: #757575;
      --shoppe-light-gray: #f5f5f5;
      --shoppe-white: #ffffff;
      --shoppe-green: #4caf50;
      --shoppe-blue: #2196f3;
      --shoppe-yellow: #ffc107;
      --shoppe-purple: #9c27b0;
      --shoppe-teal: #009688;
      --shoppe-brown: #795548;
      --primary: var(--shoppe-dark);
      --primary-light: #424242;
      --secondary: var(--shoppe-red);
      --secondary-light: var(--shoppe-red-light);
      --success: var(--shoppe-green);
      --success-light: #66bb6a;
      --warning: var(--shoppe-orange);
      --error: var(--shoppe-red);
      --bg: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
      --card-bg: var(--shoppe-white);
      --text: var(--shoppe-dark);
      --text-light: var(--shoppe-gray);
      --border: #e0e0e0;
      --shadow: 0 10px 25px rgba(229, 57, 53, 0.08);
      --shadow-hover: 0 15px 35px rgba(229, 57, 53, 0.15);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    body {
      background: var(--bg);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 10px;
      color: var(--text);
      line-height: 1.6;
      transition: var(--transition);
    }
    
    /* Tela de Login */
    .login-container {
      background: var(--card-bg);
      padding: 30px 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 420px;
      text-align: center;
      display: block;
      transition: var(--transition);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    
    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, var(--shoppe-red), var(--shoppe-orange));
    }
    
    .login-container:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-5px);
    }
    
    .login-logo {
      margin-bottom: 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    .logo-icon {
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      box-shadow: 0 8px 20px rgba(229, 57, 53, 0.3);
    }
    
    .login-container h2 {
      color: var(--shoppe-red);
      margin-bottom: 10px;
      font-weight: 700;
      font-size: 22px;
      line-height: 1.3;
    }
    
    .login-subtitle {
      color: var(--text-light);
      margin-bottom: 25px;
      font-size: 14px;
    }
    
    .input-group {
      position: relative;
      margin-bottom: 20px;
      text-align: left;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--primary);
      font-size: 13px;
    }
    
    .input-icon {
      position: absolute;
      left: 15px;
      top: 38px;
      color: var(--text-light);
      font-size: 16px;
    }
    
    .login-container input {
      width: 100%;
      padding: 14px 15px 14px 45px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      transition: var(--transition);
      background-color: var(--shoppe-light-gray);
      color: var(--text);
    }
    
    .login-container input:focus {
      outline: none;
      border-color: var(--shoppe-red);
      box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.1);
      background-color: white;
    }
    
    .login-container button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 10px;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .login-container button:hover {
      background: linear-gradient(135deg, var(--shoppe-orange), var(--shoppe-red));
      box-shadow: 0 10px 20px rgba(229, 57, 53, 0.3);
      transform: translateY(-2px);
    }
    
    .login-container button:active {
      transform: translateY(0);
    }
    
    .login-error {
      color: var(--shoppe-red);
      margin-top: 12px;
      font-size: 13px;
      display: none;
      padding: 10px;
      background-color: rgba(229, 57, 53, 0.08);
      border-radius: 8px;
      border-left: 4px solid var(--shoppe-red);
    }
    
    /* Layout Principal com Menu Lateral */
    .app-container {
      display: none;
      width: 100%;
      max-width: 1400px;
      min-height: 90vh;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    
    .app-header {
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      padding: 15px 20px;
      color: white;
      display: flex;
      flex-direction: column;
      gap: 15px;
      box-shadow: 0 5px 15px rgba(229, 57, 53, 0.2);
      position: relative;
      z-index: 10;
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-logo {
      background: rgba(255, 255, 255, 0.15);
      width: 45px;
      height: 45px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .header-title h2 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 3px;
      line-height: 1.2;
    }
    
    .header-title p {
      font-size: 12px;
      opacity: 0.9;
      display: none;
    }
    
    .user-info {
      background: rgba(255, 255, 255, 0.15);
      padding: 8px 15px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 13px;
    }
    
    .user-info i {
      font-size: 16px;
    }
    
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
    }
    
    .main-content {
      display: flex;
      min-height: calc(90vh - 90px);
      position: relative;
    }
    
    /* Menu Lateral */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #2c2c2c 0%, #1a1a1a 100%);
      padding: 25px 15px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      transition: transform 0.3s ease;
      z-index: 100;
    }
    
    .sidebar.mobile-hidden {
      transform: translateX(-100%);
    }
    
    .nav-section {
      margin-bottom: 25px;
    }
    
    .nav-title {
      color: rgba(255, 255, 255, 0.5);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      padding-left: 10px;
    }
    
    .nav-menu {
      list-style: none;
    }
    
    .nav-item {
      margin-bottom: 5px;
    }
    
    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 15px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      border-radius: 10px;
      transition: var(--transition);
      font-weight: 500;
      font-size: 14px;
      border-left: 4px solid transparent;
    }
    
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      border-left-color: var(--shoppe-orange);
    }
    
    .nav-link.active {
      background: linear-gradient(135deg, rgba(229, 57, 53, 0.2), rgba(255, 111, 0, 0.2));
      color: white;
      border-left-color: var(--shoppe-red);
    }
    
    .nav-link i {
      width: 20px;
      text-align: center;
      font-size: 16px;
    }
    
    .nav-item.logout {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .nav-link.logout {
      color: #ff6b6b;
    }
    
    .nav-link.logout:hover {
      background: rgba(255, 107, 107, 0.1);
      color: #ff6b6b;
    }
    
    /* Conte√∫do Principal */
    .content-area {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f9f9f9;
      min-height: calc(100vh - 130px);
    }
    
    .content-area h3 {
      color: var(--shoppe-red);
      font-size: 20px;
      margin-bottom: 15px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Formul√°rio de Feedback */
    .feedback-form-container {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }
    
    .form-section {
      margin-bottom: 25px;
    }
    
    .form-section h4 {
      font-size: 16px;
      color: var(--shoppe-red);
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .form-section h4 i {
      color: var(--shoppe-red);
    }
    
    label {
      display: block;
      margin: 0 0 6px 5px;
      color: var(--primary);
      font-weight: 600;
      font-size: 13px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 14px 15px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      transition: var(--transition);
      background-color: var(--shoppe-light-gray);
      color: var(--text);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--shoppe-red);
      box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.1);
      background-color: white;
    }
    
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23757575' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 16px;
      padding-right: 45px;
    }
    
    textarea {
      height: 100px;
      resize: vertical;
      line-height: 1.5;
    }
    
    .nota-container {
      background: linear-gradient(135deg, #fff8f8 0%, #fff0f0 100%);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #ffe0e0;
      margin-bottom: 20px;
    }
    
    .nota-display {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 8px;
    }
    
    .nota-slider {
      width: 100%;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 5px;
      background: linear-gradient(to right, var(--shoppe-red), var(--shoppe-orange), var(--shoppe-green));
      outline: none;
    }
    
    .nota-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
      border: 3px solid var(--shoppe-red);
      box-shadow: 0 4px 10px rgba(229, 57, 53, 0.2);
      transition: var(--transition);
    }
    
    .nota-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      border-color: var(--shoppe-orange);
    }
    
    .nota-value {
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 18px;
      text-align: center;
      transition: var(--transition);
      box-shadow: 0 4px 10px rgba(229, 57, 53, 0.2);
    }
    
    .nota-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 11px;
      color: var(--text-light);
    }
    
    .nota-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      font-size: 13px;
      color: var(--primary);
    }
    
    .nota-indicator-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--shoppe-red);
    }
    
    .signature-container {
      margin: 20px 0;
      padding: 20px;
      background: linear-gradient(135deg, #fff8f8 0%, #fff0f0 100%);
      border-radius: 10px;
      border: 2px dashed #ffcdd2;
      transition: var(--transition);
    }
    
    .signature-container:hover {
      border-color: var(--shoppe-red);
      background: linear-gradient(135deg, #fff0f0 0%, #ffe0e0 100%);
    }
    
    .signature-label {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .signature-label label {
      margin: 0;
      font-size: 15px;
      color: var(--shoppe-red);
    }
    
    .signature-label button {
      padding: 10px 15px;
      background: linear-gradient(135deg, var(--shoppe-red), #ff5252);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
    }
    
    .signature-label button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(229, 57, 53, 0.2);
    }
    
    .signature-pad {
      border-radius: 8px;
      background: white;
      width: 100%;
      height: 150px;
      position: relative;
      cursor: crosshair;
      overflow: hidden;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--border);
    }
    
    #signatureCanvas {
      width: 100%;
      height: 100%;
      display: block;
      background: white;
    }
    
    .signature-instructions {
      text-align: center;
      font-size: 12px;
      color: var(--shoppe-red);
      margin-top: 10px;
      font-style: italic;
    }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 25px;
    }
    
    .btn-group .btn-submit {
      width: 100%;
    }
    
    .btn-submit {
      padding: 16px;
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }
    
    .btn-submit:hover {
      background: linear-gradient(135deg, var(--shoppe-orange), var(--shoppe-red));
      box-shadow: 0 10px 20px rgba(229, 57, 53, 0.3);
      transform: translateY(-2px);
    }
    
    .btn-submit:disabled {
      background: #bdbdbd;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-submit.secondary {
      background: linear-gradient(135deg, var(--shoppe-blue), #2979ff) !important;
    }
    
    .btn-submit.secondary:hover {
      background: linear-gradient(135deg, #2979ff, var(--shoppe-blue)) !important;
      box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3) !important;
    }
    
    .loader {
      display: none;
      text-align: center;
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #fff8f8 0%, #fff0f0 100%);
      border-radius: 10px;
      color: var(--shoppe-red);
      font-weight: 600;
      font-size: 14px;
    }
    
    .loader i {
      margin-right: 10px;
      color: var(--shoppe-red);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .form-footer {
      text-align: center;
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid var(--border);
      color: var(--text-light);
      font-size: 12px;
    }
    
    /* P√°gina Meus Feedbacks - MOBILE FRIENDLY */
    .feedbacks-container {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .feedbacks-header {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .feedbacks-header h3 {
      margin: 0;
      color: var(--shoppe-red);
      font-size: 18px;
    }
    
    .feedbacks-header p {
      color: var(--text-light);
      font-size: 13px;
      margin-top: 5px;
    }
    
    /* Cards para mobile em vez de tabela */
    .feedbacks-cards {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .feedback-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }
    
    .feedback-card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #e0e0e0;
    }
    
    .feedback-date {
      font-size: 14px;
      font-weight: 600;
      color: var(--shoppe-red);
    }
    
    .feedback-time {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 3px;
    }
    
    .feedback-number {
      background: linear-gradient(135deg, var(--shoppe-red), var(--shoppe-orange));
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .feedback-info-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 15px;
    }
    
    .info-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .info-label {
      font-size: 11px;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .info-value {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }
    
    .feedback-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .nota-display-small {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: bold;
      color: white;
      min-width: 60px;
      font-size: 13px;
    }
    
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .feedback-message {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px dashed #e0e0e0;
    }
    
    .message-preview {
      font-size: 13px;
      color: var(--text);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Tabela apenas para desktop */
    .feedbacks-table-container {
      display: none;
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
    }
    
    .feedbacks-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    
    .feedbacks-table thead {
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
    }
    
    .feedbacks-table th {
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
      color: #1a237e;
      border-bottom: 2px solid #e0e0e0;
      white-space: nowrap;
      font-size: 13px;
    }
    
    .feedbacks-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
      vertical-align: top;
      font-size: 13px;
    }
    
    .feedbacks-table tbody tr:hover {
      background-color: #f9f9f9;
    }
    
    /* P√°gina de Relat√≥rios */
    .reports-container {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    
    .chart-container {
      background: white;
      border-radius: 10px;
      padding: 15px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .chart-header h4 {
      margin: 0;
      color: var(--shoppe-red);
      font-size: 15px;
    }
    
    .chart-wrapper {
      position: relative;
      height: 250px;
      width: 100%;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
    }
    
    .stat-value {
      font-size: 22px;
      font-weight: 700;
      color: var(--shoppe-red);
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 500;
    }
    
    .stat-trend {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      margin-top: 8px;
    }
    
    .stat-trend.positive {
      color: var(--shoppe-green);
    }
    
    .stat-trend.negative {
      color: var(--shoppe-red);
    }
    
    /* Modal de Confirma√ß√£o */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(229, 57, 53, 0.95) 0%, rgba(255, 111, 0, 0.95) 100%);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      padding: 15px;
      backdrop-filter: blur(8px);
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .confirmation-modal {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
      width: 100%;
      max-width: 480px;
      overflow: hidden;
      animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: none;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .modal-header {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      padding: 20px 25px;
      color: white;
      text-align: center;
      position: relative;
    }
    
    .modal-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--shoppe-orange);
      border-radius: 2px;
    }
    
    .modal-header h3 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      letter-spacing: 0.5px;
    }
    
    .modal-header h3 i {
      color: var(--shoppe-orange);
      font-size: 22px;
    }
    
    .modal-subtitle {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 5px;
      font-weight: 400;
    }
    
    .modal-content {
      padding: 20px;
      max-height: 60vh;
      overflow-y: auto;
    }
    
    .data-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .data-item {
      padding: 15px;
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
      border-radius: 10px;
      border-left: 4px solid #1a237e;
      transition: var(--transition);
    }
    
    .data-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(26, 35, 126, 0.1);
    }
    
    .data-item.full-width {
      grid-column: 1 / -1;
    }
    
    .data-item label {
      font-size: 10px;
      color: #5c6bc0;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .data-item .data-value {
      font-size: 14px;
      color: #1a237e;
      font-weight: 500;
      word-break: break-word;
      line-height: 1.5;
    }
    
    .data-item .data-value.large {
      font-size: 16px;
      font-weight: 600;
      color: #e53935;
    }
    
    .signature-display {
      background: white;
      border: 2px solid #e8eaf6;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      text-align: center;
    }
    
    .signature-label-text {
      font-size: 11px;
      color: #5c6bc0;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 10px;
      letter-spacing: 0.8px;
    }
    
    .signature-preview-box {
      width: 100%;
      max-width: 250px;
      height: 60px;
      margin: 0 auto;
      border: 1px solid #e8eaf6;
      border-radius: 8px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      padding: 8px;
    }
    
    .signature-preview-box img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .no-signature {
      color: #9fa8da;
      font-style: italic;
      font-size: 12px;
    }
    
    .warning-box {
      background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
      border-left: 4px solid #ffb300;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .warning-box i {
      color: #ffb300;
      font-size: 18px;
      margin-top: 2px;
    }
    
    .warning-content {
      flex: 1;
    }
    
    .warning-content h4 {
      color: #5d4037;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .warning-content p {
      color: #795548;
      font-size: 11px;
      line-height: 1.5;
    }
    
    .modal-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 20px;
      background: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
      border-top: 1px solid #e0e0e0;
    }
    
    .modal-btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: 0.5px;
    }
    
    .modal-btn-confirm {
      background: linear-gradient(135deg, #00c853 0%, #00e676 100%);
      color: white;
      box-shadow: 0 6px 15px rgba(0, 200, 83, 0.3);
    }
    
    .modal-btn-confirm:hover {
      background: linear-gradient(135deg, #00e676 0%, #00c853 100%);
      box-shadow: 0 10px 20px rgba(0, 200, 83, 0.4);
      transform: translateY(-2px);
    }
    
    .modal-btn-confirm:active {
      transform: translateY(0);
    }
    
    .modal-btn-cancel {
      background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
      color: #616161;
      border: 2px solid #e0e0e0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    
    .modal-btn-cancel:hover {
      background: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
      border-color: #bdbdbd;
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* Pagina√ß√£o Mobile */
    .pagination {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
    }
    
    .pagination-info {
      font-size: 13px;
      color: #666;
      font-weight: 500;
      text-align: center;
    }
    
    .pagination-controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .pagination-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    
    .pagination-button {
      background: linear-gradient(135deg, var(--shoppe-blue), #0d47a1);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
      transition: all 0.3s ease;
      min-width: 40px;
    }
    
    .pagination-button:hover:not(:disabled) {
      background: linear-gradient(135deg, #0d47a1, var(--shoppe-blue));
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(13, 71, 161, 0.3);
    }
    
    .pagination-button:disabled {
      background: #bdbdbd;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .page-numbers {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .page-number {
      min-width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
      border: 1px solid #e0e0e0;
      color: #666;
      font-size: 13px;
    }
    
    .page-number:hover:not(.active) {
      background: #f0f0f0;
      border-color: var(--shoppe-blue);
      color: var(--shoppe-blue);
    }
    
    .page-number.active {
      background: linear-gradient(135deg, var(--shoppe-blue), #0d47a1);
      color: white;
      border-color: var(--shoppe-blue);
      box-shadow: 0 2px 5px rgba(33, 150, 243, 0.2);
    }
    
    .page-ellipsis {
      min-width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 13px;
    }
    
    .items-per-page {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
      color: #666;
      flex-wrap: wrap;
    }
    
    .items-per-page select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      background: white;
      font-size: 13px;
      width: 80px;
    }
    
    /* Overlay para menu mobile */
    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      backdrop-filter: blur(3px);
    }
    
    /* Responsividade */
    @media (min-width: 768px) {
      body {
        padding: 20px;
      }
      
      .login-container {
        padding: 40px 35px;
      }
      
      .logo-icon {
        width: 70px;
        height: 70px;
        font-size: 32px;
      }
      
      .login-container h2 {
        font-size: 28px;
      }
      
      .input-group {
        margin-bottom: 25px;
      }
      
      .input-group label {
        font-size: 14px;
      }
      
      .login-container input {
        padding: 16px 20px 16px 52px;
        font-size: 16px;
      }
      
      .input-icon {
        left: 18px;
        top: 42px;
        font-size: 18px;
      }
      
      .login-container button {
        padding: 18px;
        font-size: 16px;
      }
      
      .app-header {
        padding: 20px 30px;
        flex-direction: row;
        justify-content: space-between;
        gap: 0;
      }
      
      .header-title p {
        display: block;
        font-size: 13px;
      }
      
      .header-title h2 {
        font-size: 22px;
      }
      
      .mobile-menu-btn {
        display: none;
      }
      
      .content-area {
        padding: 30px;
      }
      
      .content-area h3 {
        font-size: 24px;
      }
      
      .feedback-form-container {
        padding: 30px;
      }
      
      .form-section h4 {
        font-size: 18px;
      }
      
      .btn-group {
        flex-direction: row;
      }
      
      .btn-group .btn-submit {
        width: auto;
      }
      
      .nota-display {
        flex-direction: row;
      }
      
      .signature-label {
        flex-direction: row;
        justify-content: space-between;
      }
      
      .signature-label button {
        width: auto;
      }
      
      /* Meus Feedbacks - Desktop */
      .feedbacks-table-container {
        display: block;
      }
      
      .feedbacks-cards {
        display: none;
      }
      
      .feedback-info-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .charts-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .chart-container:last-child {
        grid-column: 1 / -1;
      }
      
      .pagination {
        flex-direction: row;
        justify-content: space-between;
      }
      
      .pagination-controls {
        flex-direction: row;
        align-items: center;
      }
      
      .pagination-buttons {
        order: 1;
      }
      
      .modal-actions {
        flex-direction: row;
      }
      
      .modal-btn {
        width: auto;
      }
      
      .data-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (min-width: 992px) {
      .sidebar {
        width: 280px;
        padding: 30px 20px;
      }
      
      .nav-link {
        padding: 15px 20px;
        font-size: 15px;
      }
      
      .nav-title {
        font-size: 12px;
      }
      
      .header-title h2 {
        font-size: 24px;
      }
    }
    
    @media (max-width: 767px) {
      .mobile-menu-btn {
        display: block;
      }
      
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        z-index: 100;
        transform: translateX(-100%);
      }
      
      .sidebar.mobile-visible {
        transform: translateX(0);
      }
      
      .mobile-overlay.visible {
        display: block;
      }
      
      .content-area {
        width: 100%;
      }
      
      .app-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .header-top {
        width: 100%;
      }
      
      .user-info {
        width: 100%;
        justify-content: center;
        margin-top: 10px;
      }
      
      /* Ajustes espec√≠ficos para a tabela em mobile */
      .feedbacks-table-container {
        display: none !important;
      }
      
      .feedbacks-cards {
        display: flex;
      }
      
      /* Ajustes para cards de feedback */
      .feedback-info-grid {
        grid-template-columns: 1fr;
      }
      
      .feedback-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      
      .feedback-number {
        align-self: flex-start;
      }
    }
    
    @media (max-width: 480px) {
      .login-container {
        padding: 25px 20px;
      }
      
      .login-container h2 {
        font-size: 20px;
      }
      
      .app-container {
        border-radius: 12px;
      }
      
      .content-area {
        padding: 15px;
      }
      
      .feedback-form-container,
      .feedbacks-container,
      .reports-container {
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-content {
        padding: 15px;
      }
      
      .modal-header {
        padding: 20px;
      }
      
      .modal-header h3 {
        font-size: 16px;
      }
      
      .data-item {
        padding: 12px;
      }
      
      .feedback-card {
        padding: 15px;
      }
      
      .pagination {
        padding: 15px;
      }
      
      .page-numbers {
        gap: 3px;
      }
      
      .page-number {
        min-width: 32px;
        height: 32px;
        font-size: 12px;
      }
      
      .pagination-button {
        padding: 8px 12px;
        font-size: 12px;
        min-width: 35px;
      }
    }
    
    @media (min-width: 1200px) {
      .charts-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .chart-container:last-child {
        grid-column: span 2;
      }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    /* Estilos para SweetAlert */
    .swal2-popup .loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .swal2-popup .loader i {
      font-size: 24px;
      color: #2196f3;
      margin-bottom: 10px;
    }
    
    .swal2-popup .loader-text {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
    
    /* Bot√£o de alternar visualiza√ß√£o */
    .view-toggle {
      display: flex;
      justify-content: center;
      margin: 15px 0;
      gap: 10px;
    }
    
    .view-btn {
      padding: 8px 15px;
      border: 1px solid #e0e0e0;
      background: white;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .view-btn.active {
      background: linear-gradient(135deg, var(--shoppe-blue), #0d47a1);
      color: white;
      border-color: var(--shoppe-blue);
    }
    
    .view-btn:hover:not(.active) {
      background: #f5f5f5;
    }
    
    @media (min-width: 768px) {
      .view-toggle {
        display: none;
      }
    }
  </style>
</head>
<body>

<!-- Tela de Login -->
<div class="login-container" id="loginScreen">
  <div class="login-logo">
    <div class="logo-icon">
      <i class="fas fa-comment-dots"></i>
    </div>
    <div>
      <h2>Registro de Feedback</h2>
      <p class="login-subtitle">Diffs e Ocorr√™ncias da Qualidade</p>
    </div>
  </div>
  
  <form id="loginForm">
    <div class="input-group">
      <label for="loginEmail"><i class="fas fa-envelope"></i> E-mail</label>
      <div class="input-icon">
        <i class="fas fa-user"></i>
      </div>
      <input type="email" id="loginEmail" placeholder="seu.email@empresa.com" required>
    </div>
    
    <div class="login-info">
      <p style="text-align: center; color: var(--shoppe-gray); font-size: 13px; margin: 15px 0 25px;">
        <i class="fas fa-info-circle"></i> Digite seu e-mail corporativo para acessar o sistema
      </p>
    </div>
    
    <button type="submit">
      <i class="fas fa-sign-in-alt"></i>
      Acessar Sistema
    </button>
    
    <div class="login-error" id="loginError">
      <i class="fas fa-exclamation-circle"></i>
      <span id="errorText">E-mail inv√°lido!</span>
    </div>
  </form>
  
  <div class="form-footer">
    <p>Todos os direitos reservados.</p>
  </div>
</div>

<!-- Aplicativo Principal com Menu Lateral -->
<div class="app-container" id="appScreen">
  <div class="app-header">
    <div class="header-top">
      <div class="header-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i class="fas fa-bars"></i>
        </button>
        <div class="header-logo">
          <i class="fas fa-comments"></i>
        </div>
        <div class="header-title">
          <h2>Registro de Feedback</h2>
          <p>Sistema de Diffs e Ocorr√™ncias da Qualidade</p>
        </div>
      </div>
      
      <div class="user-info" id="userInfo">
        <i class="fas fa-user-circle"></i>
        <span>Usu√°rio: <strong id="loggedUser"></strong></span>
      </div>
    </div>
  </div>
  
  <div class="mobile-overlay" id="mobileOverlay"></div>
  
  <div class="main-content">
    <!-- Menu Lateral -->
    <div class="sidebar" id="sidebar">
      <div class="nav-section">
        <div class="nav-title">Navega√ß√£o</div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="#" class="nav-link active" data-page="feedback">
              <i class="fas fa-plus-circle"></i>
              Novo Feedback
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="meus-feedbacks">
              <i class="fas fa-history"></i>
              Meus Feedbacks
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="relatorios">
              <i class="fas fa-chart-bar"></i>
              Relat√≥rios
            </a>
          </li>
        </ul>
      </div>
      
      <div class="nav-section">
        <div class="nav-title">A√ß√µes R√°pidas</div>
        <ul class="nav-menu">
          <li class="nav-item">
            <button class="nav-link" onclick="exportarFeedbacksPDF()" style="background: none; border: none; cursor: pointer; text-align: left; width: 100%;">
              <i class="fas fa-file-pdf"></i>
              Exportar PDF
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" onclick="atualizarListaColaboradores()">
              <i class="fas fa-sync-alt"></i>
              Atualizar Lista
            </button>
          </li>
        </ul>
      </div>
      
      <div class="nav-section">
        <ul class="nav-menu">
          <li class="nav-item logout">
            <a href="#" class="nav-link logout" id="btnLogout">
              <i class="fas fa-sign-out-alt"></i>
              Sair
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <!-- √Årea de Conte√∫do -->
    <div class="content-area" id="contentArea">
      <!-- P√°gina: Novo Feedback -->
      <div id="page-feedback" class="page-content active">
        <h3><i class="fas fa-plus-circle"></i> Registrar Novo Feedback</h3>
        
        <div class="feedback-form-container">
          <form id="feedbackForm">
            <div class="form-section">
              <h4><i class="fas fa-user-tie"></i> Informa√ß√µes do Feedback</h4>
              
              <div class="input-group">
                <label for="gestor">Nome do Gestor</label>
                <input type="text" id="gestor" placeholder="Quem est√° aplicando o feedback?" required>
              </div>
              
              <div class="input-group">
                <label for="colaborador">Colaborador</label>
                <select id="colaborador" required disabled>
                  <option value="">Carregando lista de colaboradores...</option>
                </select>
              </div>
              
              <div class="input-group">
                <label for="tipo">Tipo de Feedback</label>
                <select id="tipo" required>
                  <option value="">Selecione o tipo de feedback...</option>
                  <option value="Qualidade Putaway">üì¶ Qualidade Putaway</option>
                  <option value="Sugest√£o de Melhoria">üí° Sugest√£o de Melhoria</option>
                  <option value="OB Verdadeiro - PNE">‚úÖ OB Verdadeiro - PNE</option>
                  <option value="OB Verdadeiro - PE">‚úÖ OB Verdadeiro - PE</option>
                  <option value="OB Falso">‚ùå OB Falso</option>
                </select>
              </div>

              <div class="input-group">
                <label for="endereco">Endere√ßo WMS</label>
                <input type="text" id="endereco" placeholder="Digite o endere√ßo" required>
              </div>

              <div class="input-group">
                <label for="enderecoTratado">Endere√ßo Tratado</label>
                <select id="enderecoTratado" required>
                  <option value="">Selecione uma op√ß√£o...</option>
                  <option value="Concluido">‚úÖ Conclu√≠do</option>
                  <option value="Pendente">‚è≥ Pendente</option>
                  <option value="NA">‚ö™ NA (N√£o se aplica)</option>
                </select>
              </div>
              
              <div class="nota-container">
                <label>Nota do Feedback</label>
                <div class="nota-display">
                  <input type="range" 
                         id="nota" 
                         min="1" 
                         max="10" 
                         step="1" 
                         value="5"
                         class="nota-slider"
                         oninput="updateNotaDisplay(this.value)">
                  <div class="nota-value" id="notaValue">5/10</div>
                </div>
                <div class="nota-labels">
                  <span>1 - Baixo</span>
                  <span>10 - Excelente</span>
                </div>
                <div class="nota-indicator">
                  <div class="nota-indicator-dot" id="notaIndicator"></div>
                  <span id="notaTexto">Neutro - Satisfat√≥rio</span>
                </div>
              </div>
              
              <div class="input-group">
                <label for="mensagem">Descri√ß√£o do Feedback</label>
                <textarea id="mensagem" placeholder="Descreva os pontos abordados no feedback, observa√ß√µes importantes, resultados esperados, etc." required></textarea>
              </div>
            </div>
            
            <div class="form-section">
              <h4><i class="fas fa-signature"></i> Assinatura do Colaborador</h4>
              
              <div class="signature-container">
                <div class="signature-label">
                  <label>Assine no espa√ßo abaixo</label>
                  <button type="button" onclick="clearSignature()">
                    <i class="fas fa-eraser"></i>
                    Limpar Assinatura
                  </button>
                </div>
                
                <div class="signature-pad" id="signaturePad">
                  <canvas id="signatureCanvas"></canvas>
                </div>
                
                <div class="signature-instructions">
                  <i class="fas fa-mouse-pointer"></i> Clique e arraste para assinar acima
                </div>
              </div>
            </div>
            
            <div class="btn-group">
              <button type="submit" class="btn-submit" id="btnEnviar">
                <i class="fas fa-paper-plane"></i>
                Registrar Feedback
              </button>
              
              <button type="button" class="btn-submit secondary" onclick="limparFormulario()">
                <i class="fas fa-broom"></i>
                Limpar Formul√°rio
              </button>
            </div>
            
            <div class="loader" id="loader">
              <i class="fas fa-circle-notch"></i>
              Enviando feedback para o sistema...
            </div>
          </form>
          
          <div class="form-footer">
            <p><i class="fas fa-shield-alt"></i> Os dados s√£o armazenados de forma segura e confidencial.</p>
          </div>
        </div>
      </div>
      
      <!-- P√°gina: Meus Feedbacks -->
      <div id="page-meus-feedbacks" class="page-content" style="display: none;">
        <h3><i class="fas fa-history"></i> Meus Feedbacks Registrados</h3>
        
        <div class="feedbacks-container">
          <div class="feedbacks-header">
            <div>
              <h3>Hist√≥rico de Feedbacks</h3>
              <p>Visualize todos os feedbacks registrados por voc√™</p>
            </div>
            
            <div class="btn-group" style="flex-direction: row; gap: 10px;">
              <button class="btn-submit secondary" onclick="carregarMeusFeedbacks()" style="flex: 1;">
                <i class="fas fa-sync-alt"></i>
                Atualizar
              </button>
              
              <button class="btn-submit secondary" onclick="alternarVisualizacao()" id="toggleViewBtn" style="flex: 1;">
                <i class="fas fa-th-list"></i>
                Cards
              </button>
            </div>
          </div>
          
          <!-- Cards para Mobile -->
          <div id="feedbacksCards" class="feedbacks-cards">
            <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
              <i class="fas fa-history" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0;"></i>
              <h4 style="margin-bottom: 10px; color: var(--text-light);">Nenhum feedback carregado</h4>
              <p style="font-size: 14px;">Clique em "Atualizar" para carregar seus feedbacks</p>
            </div>
          </div>
          
          <!-- Tabela para Desktop -->
          <div class="feedbacks-table-container">
            <table class="feedbacks-table">
              <thead>
                <tr>
                  <th>DATA/HORA</th>
                  <th>COLABORADOR</th>
                  <th>TIPO</th>
                  <th>NOTA</th>
                  <th>ENDERE√áO WMS</th>
                  <th>STATUS</th>
                </tr>
              </thead>
              <tbody id="feedbacksTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-light);">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0; display: block;"></i>
                    <h4 style="margin-bottom: 10px; color: var(--text-light);">Nenhum feedback carregado</h4>
                    <p style="font-size: 14px;">Clique em "Atualizar" para carregar seus feedbacks</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="pagination" id="paginationControls" style="display: none;">
            <!-- Pagina√ß√£o ser√° inserida aqui -->
          </div>
        </div>
      </div>
      
      <!-- P√°gina: Relat√≥rios -->
      <div id="page-relatorios" class="page-content" style="display: none;">
        <h3><i class="fas fa-chart-bar"></i> Relat√≥rios e Estat√≠sticas</h3>
        
        <div class="reports-container">
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
              <div class="stat-header">
                <div>
                  <div class="stat-value" id="totalFeedbacks">0</div>
                  <div class="stat-label">Total de Feedbacks</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #e53935, #ff5252);">
                  <i class="fas fa-comments"></i>
                </div>
              </div>
              <div class="stat-trend positive">
                <i class="fas fa-arrow-up"></i>
                <span>Atualizado agora</span>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-header">
                <div>
                  <div class="stat-value" id="avgNota">0.0</div>
                  <div class="stat-label">Nota M√©dia</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #ff6f00, #ff9100);">
                  <i class="fas fa-star"></i>
                </div>
              </div>
              <div class="stat-trend positive">
                <i class="fas fa-chart-line"></i>
                <span>Desempenho</span>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-header">
                <div>
                  <div class="stat-value" id="topTipo">-</div>
                  <div class="stat-label">Tipo Mais Comum</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #2196f3, #2979ff);">
                  <i class="fas fa-chart-pie"></i>
                </div>
              </div>
              <div class="stat-trend positive">
                <i class="fas fa-info-circle"></i>
                <span>An√°lise</span>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-header">
                <div>
                  <div class="stat-value" id="completionRate">0%</div>
                  <div class="stat-label">Taxa de Conclus√£o</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #4caf50, #66bb6a);">
                  <i class="fas fa-check-circle"></i>
                </div>
              </div>
              <div class="stat-trend positive">
                <i class="fas fa-percentage"></i>
                <span>Efici√™ncia</span>
              </div>
            </div>
          </div>
          
          <div class="charts-grid" id="chartsGrid">
            <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
              <i class="fas fa-chart-bar" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0;"></i>
              <h4 style="margin-bottom: 10px; color: var(--text-light);">Carregando relat√≥rios...</h4>
              <p style="font-size: 14px; margin-bottom: 20px;">Registre alguns feedbacks para gerar estat√≠sticas e gr√°ficos</p>
              <button class="btn-submit" onclick="gerarRelatorios()" style="max-width: 200px; margin: 0 auto;">
                <i class="fas fa-chart-line"></i>
                Gerar Relat√≥rios
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirma√ß√£o -->
<div class="modal-overlay" id="confirmationModal">
  <div class="confirmation-modal">
    <div class="modal-header">
      <h3><i class="fas fa-clipboard-check"></i> CONFIRMA√á√ÉO</h3>
      <div class="modal-subtitle">Revise os dados antes de enviar</div>
    </div>
    
    <div class="modal-content">
      <div class="data-grid">
        <div class="data-item">
          <label><i class="far fa-calendar"></i> DATA/HORA</label>
          <div class="data-value" id="confirmDataHora"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-user-tie"></i> GESTOR</label>
          <div class="data-value" id="confirmGestor"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-user"></i> COLABORADOR</label>
          <div class="data-value" id="confirmColaborador"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-tag"></i> TIPO DE FEEDBACK </label>
          <div class="data-value" id="confirmTipo"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-map-marker-alt"></i> ENDERE√áO WMS</label>
          <div class="data-value" id="confirmEndereco"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-check-circle"></i> ENDERE√áO TRATADO?</label>
          <div class="data-value" id="confirmEnderecoTratado"></div>
        </div>
        
        <div class="data-item">
          <label><i class="fas fa-star"></i> NOTA</label>
          <div class="data-value large" id="confirmNota"></div>
        </div>
        
        <div class="data-item full-width">
          <label><i class="fas fa-comment"></i> MENSAGEM</label>
          <div class="data-value" id="confirmMensagem"></div>
        </div>
      </div>
      
      <div class="signature-display">
        <div class="signature-label-text">
          <i class="fas fa-signature"></i> ASSINATURA DO COLABORADOR
        </div>
        <div class="signature-preview-box" id="signaturePreviewContainer">
          <img id="confirmAssinatura" src="" alt="Assinatura" style="display: none;">
          <div class="no-signature" id="noSignatureText">Assinatura n√£o fornecida</div>
        </div>
      </div>
      
      <div class="warning-box">
        <i class="fas fa-exclamation-triangle"></i>
        <div class="warning-content">
          <h4>ATEN√á√ÉO</h4>
          <p>Verifique se todos os dados est√£o corretos antes de confirmar. Ap√≥s o envio, n√£o ser√° poss√≠vel alterar as informa√ß√µes.</p>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" class="modal-btn modal-btn-cancel" id="btnCancelar">
        <i class="fas fa-edit"></i> Corrigir Dados
      </button>
      <button type="button" class="modal-btn modal-btn-confirm" id="btnConfirmar">
        <i class="fas fa-check-double"></i> Confirmar Envio
      </button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // URL do Google Apps Script
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_nw5Sgs-QxQjhg3q8141TIjro-eC8gAus3OesLt314CAL0x_Q_vCxieAgiXILBIQG4Q/exec";
  
  // Estado do sistema
  let usuarioLogado = null;
  let isDrawing = false;
  let lastX = 0;
  let lastY = 0;
  let canvas, ctx;
  let enviando = false;
  let meusFeedbacks = [];
  let currentFeedbacksPage = 1;
  let feedbacksPerPage = 10;
  let visualizacaoAtual = 'cards'; // 'cards' ou 'tabela'
  
  // Configura√ß√µes para otimiza√ß√£o da assinatura
  const CANVAS_WIDTH = 400;
  const CANVAS_HEIGHT = 150;
  const LINE_WIDTH = 2;

  // ===== FUN√á√ïES PARA NAVEGA√á√ÉO MOBILE =====
  function setupMobileNavigation() {
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const sidebar = document.getElementById('sidebar');
    const mobileOverlay = document.getElementById('mobileOverlay');
    
    mobileMenuBtn.addEventListener('click', function() {
      sidebar.classList.toggle('mobile-visible');
      mobileOverlay.classList.toggle('visible');
      document.body.style.overflow = sidebar.classList.contains('mobile-visible') ? 'hidden' : 'auto';
    });
    
    mobileOverlay.addEventListener('click', function() {
      sidebar.classList.remove('mobile-visible');
      mobileOverlay.classList.remove('visible');
      document.body.style.overflow = 'auto';
    });
    
    // Fechar menu ao clicar em um link
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth < 768) {
          sidebar.classList.remove('mobile-visible');
          mobileOverlay.classList.remove('visible');
          document.body.style.overflow = 'auto';
        }
      });
    });
  }

  function setupNavigation() {
    const navLinks = document.querySelectorAll('.nav-link[data-page]');
    
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const pageId = this.getAttribute('data-page');
        
        // Remover classe active de todos
        navLinks.forEach(l => l.classList.remove('active'));
        // Adicionar classe active ao link clicado
        this.classList.add('active');
        
        // Esconder todas as p√°ginas
        document.querySelectorAll('.page-content').forEach(page => {
          page.style.display = 'none';
          page.classList.remove('active');
        });
        
        // Mostrar p√°gina selecionada
        const targetPage = document.getElementById(`page-${pageId}`);
        if (targetPage) {
          targetPage.style.display = 'block';
          targetPage.classList.add('active');
        }
        
        // Carregar dados espec√≠ficos da p√°gina
        switch(pageId) {
          case 'meus-feedbacks':
            carregarMeusFeedbacks();
            break;
          case 'relatorios':
            gerarRelatorios();
            break;
          case 'feedback':
            // J√° est√° carregado
            break;
        }
      });
    });
    
    // Bot√£o de logout
    document.getElementById('btnLogout').addEventListener('click', function(e) {
      e.preventDefault();
      logout();
    });
  }

  function logout() {
    Swal.fire({
      title: 'Sair do sistema?',
      text: 'Voc√™ ser√° redirecionado para a tela de login.',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#e53935',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Sim, sair',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        sessionStorage.removeItem('feedback_usuario');
        usuarioLogado = null;
        document.getElementById('loginScreen').style.display = 'block';
        document.getElementById('appScreen').style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginEmail').focus();
      }
    });
  }

  // ===== FUN√á√ïES PARA NOTA =====
  function updateNotaDisplay(valor) {
    const notaValue = document.getElementById('notaValue');
    const notaIndicator = document.getElementById('notaIndicator');
    const notaTexto = document.getElementById('notaTexto');
    
    notaValue.textContent = valor + '/10';
    
    let cor, texto;
    if (valor <= 3) {
      cor = 'linear-gradient(135deg, #e53935, #d32f2f)';
      texto = 'Baixo - Precisa de Melhoria';
    } else if (valor <= 5) {
      cor = 'linear-gradient(135deg, #ff6f00, #f57c00)';
      texto = 'Regular - Abaixo do Esperado';
    } else if (valor <= 7) {
      cor = 'linear-gradient(135deg, #ff8a00, #ff9800)';
      texto = 'Bom - Atende Expectativas';
    } else if (valor <= 9) {
      cor = 'linear-gradient(135deg, #ff9100, #ffab00)';
      texto = '√ìtimo - Acima da M√©dia';
    } else {
      cor = 'linear-gradient(135deg, #ffab00, #ffc400)';
      texto = 'Excelente - Fora da Curva';
    }
    
    notaValue.style.background = cor;
    notaIndicator.style.background = 'var(--shoppe-orange)';
    notaTexto.textContent = texto;
    
    if (valor <= 3) {
      notaIndicator.style.background = 'var(--shoppe-red)';
    } else if (valor <= 7) {
      notaIndicator.style.background = 'var(--shoppe-orange)';
    } else {
      notaIndicator.style.background = 'var(--shoppe-yellow)';
    }
  }

  // ===== INICIALIZA√á√ÉO DA ASSINATURA OTIMIZADA =====
  function initializeSignature() {
    canvas = document.getElementById('signatureCanvas');
    ctx = canvas.getContext('2d');
    
    canvas.width = CANVAS_WIDTH;
    canvas.height = CANVAS_HEIGHT;
    
    ctx.lineWidth = LINE_WIDTH;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.strokeStyle = '#e53935';
    
    clearCanvas();
    
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    canvas.addEventListener('touchend', stopDrawing);
  }

  // ===== FUN√á√ïES DA ASSINATURA OTIMIZADAS =====
  function clearCanvas() {
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#ffcdd2';
    ctx.font = 'italic 14px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('Assine aqui', canvas.width / 2, canvas.height / 2);
  }

  function getMousePos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    return {
      x: (e.clientX - rect.left) * scaleX,
      y: (e.clientY - rect.top) * scaleY
    };
  }

  function getTouchPos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    return {
      x: (e.touches[0].clientX - rect.left) * scaleX,
      y: (e.touches[0].clientY - rect.top) * scaleY
    };
  }

  function startDrawing(e) {
    e.preventDefault();
    isDrawing = true;
    const pos = e.type.includes('mouse') ? getMousePos(e) : getTouchPos(e);
    [lastX, lastY] = [pos.x, pos.y];
    
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
  }

  function draw(e) {
    if (!isDrawing) return;
    e.preventDefault();
    
    const pos = e.type.includes('mouse') ? getMousePos(e) : getTouchPos(e);
    
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    
    [lastX, lastY] = [pos.x, pos.y];
  }

  function handleTouchStart(e) {
    if (e.cancelable) {
      e.preventDefault();
    }
    startDrawing(e);
  }

  function handleTouchMove(e) {
    if (e.cancelable) {
      e.preventDefault();
    }
    draw(e);
  }

  function stopDrawing() {
    isDrawing = false;
  }

  function clearSignature() {
    clearCanvas();
  }

  function isSignatureEmpty() {
    const blankCanvas = document.createElement('canvas');
    blankCanvas.width = canvas.width;
    blankCanvas.height = canvas.height;
    const blankCtx = blankCanvas.getContext('2d');
    
    blankCtx.fillStyle = '#ffffff';
    blankCtx.fillRect(0, 0, blankCanvas.width, blankCanvas.height);
    
    blankCtx.fillStyle = '#ffcdd2';
    blankCtx.font = 'italic 14px Arial';
    blankCtx.textAlign = 'center';
    blankCtx.textBaseline = 'middle';
    blankCtx.fillText('Assine aqui', blankCanvas.width / 2, blankCanvas.height / 2);
    
    const currentData = canvas.toDataURL('image/jpeg', 0.3);
    const blankData = blankCanvas.toDataURL('image/jpeg', 0.3);
    
    return currentData === blankData;
  }

  function getSignatureDataURL() {
    return canvas.toDataURL('image/jpeg', 0.3);
  }

  // ===== FUN√á√ïES DO MODAL =====
  function preencherModalConfirmacao() {
    const agora = new Date();
    const dataFormatada = agora.toLocaleDateString('pt-BR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    }) + ' √†s ' + agora.toLocaleTimeString('pt-BR', {
      hour: '2-digit',
      minute: '2-digit'
    });
    
    document.getElementById('confirmDataHora').textContent = dataFormatada;
    document.getElementById('confirmGestor').textContent = document.getElementById('gestor').value || "N√£o informado";
    document.getElementById('confirmColaborador').textContent = document.getElementById('colaborador').value || "N√£o selecionado";
    document.getElementById('confirmTipo').textContent = document.getElementById('tipo').value || "N√£o selecionado";
    document.getElementById('confirmEndereco').textContent = document.getElementById('endereco').value || "N√£o informado";
    document.getElementById('confirmEnderecoTratado').textContent = document.getElementById('enderecoTratado').value || "N√£o selecionado";
    document.getElementById('confirmNota').textContent = document.getElementById('nota').value + '/10';
    
    // Limitar mensagem se for muito longa
    const mensagem = document.getElementById('mensagem').value;
    document.getElementById('confirmMensagem').textContent = mensagem || "N√£o informada";
    
    // Assinatura
    const signatureData = getSignatureDataURL();
    const signatureImg = document.getElementById('confirmAssinatura');
    const noSignatureText = document.getElementById('noSignatureText');
    
    if (!isSignatureEmpty()) {
      signatureImg.src = signatureData;
      signatureImg.style.display = 'block';
      noSignatureText.style.display = 'none';
    } else {
      signatureImg.style.display = 'none';
      noSignatureText.style.display = 'block';
      noSignatureText.textContent = "Assinatura pendente";
      noSignatureText.style.color = "#e53935";
      noSignatureText.style.fontWeight = "600";
    }
  }

  function mostrarModal() {
    document.getElementById('confirmationModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }

  function esconderModal() {
    document.getElementById('confirmationModal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // ===== FUN√á√ïES DE LOGIN =====
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value.trim();
    const errorDiv = document.getElementById('loginError');
    const errorText = document.getElementById('errorText');
    
    if (!email.includes('@') || !email.includes('.')) {
      errorText.textContent = "Por favor, insira um e-mail v√°lido";
      errorDiv.style.display = 'block';
      return;
    }
    
    const loginBtn = e.target.querySelector('button');
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Acessando...';
    
    setTimeout(() => {
      usuarioLogado = {
        email: email,
        nome: email.split('@')[0].replace(/\./g, ' ').replace(/_/g, ' ')
      };
      
      usuarioLogado.nome = usuarioLogado.nome
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
      
      sessionStorage.setItem('feedback_usuario', JSON.stringify(usuarioLogado));
      
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appScreen').style.display = 'block';
      document.getElementById('loggedUser').textContent = usuarioLogado.nome;
      
      setTimeout(() => {
        initializeSignature();
        carregarColaboradores();
        updateNotaDisplay(document.getElementById('nota').value);
        setupNavigation();
        setupMobileNavigation();
      }, 100);
      
      loginBtn.disabled = false;
      loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Acessar Sistema';
    }, 800);
  });

  // ===== VERIFICAR SE J√Å EST√Å LOGADO =====
  window.addEventListener('load', function() {
    document.getElementById('loginScreen').style.display = 'block';
    document.getElementById('appScreen').style.display = 'none';
    
    sessionStorage.removeItem('feedback_usuario');
    
    setTimeout(() => {
      document.getElementById('loginEmail').focus();
    }, 300);
  });

  // ===== FUN√á√ÉO PARA CARREGAR COLABORADORES =====
  function carregarColaboradores() {
    const select = document.getElementById('colaborador');
    select.innerHTML = '<option value="">Carregando lista de colaboradores...</option>';
    select.disabled = true;
    
    fetch(SCRIPT_URL + "?getLista=true")
      .then(response => response.json())
      .then(lista => {
        select.innerHTML = '<option value="">Selecione o colaborador...</option>';
        if (lista.length === 0) {
          select.innerHTML = '<option value="">Nenhum colaborador encontrado</option>';
          return;
        }
        lista.forEach(item => {
          let opt = document.createElement('option');
          let textoCompleto = item.matricula + " - " + item.nome;
          opt.value = textoCompleto;
          opt.text = textoCompleto;
          select.appendChild(opt);
        });
        select.disabled = false;
        select.style.background = "white";
        select.style.borderColor = "#e0e0e0";
      })
      .catch(err => {
        console.error("Erro ao carregar lista:", err);
        select.innerHTML = '<option value="">Erro ao carregar. Verifique a conex√£o.</option>';
      });
  }

  function atualizarListaColaboradores() {
    Swal.fire({
      title: 'Atualizando lista...',
      text: 'Por favor, aguarde enquanto carregamos a lista de colaboradores.',
      allowOutsideClick: false,
      didOpen: () => {
        Swal.showLoading();
      }
    });
    
    carregarColaboradores();
    
    setTimeout(() => {
      Swal.close();
      Swal.fire({
        icon: 'success',
        title: 'Lista atualizada!',
        text: 'A lista de colaboradores foi atualizada com sucesso.',
        timer: 1500,
        showConfirmButton: false
      });
    }, 1000);
  }

  // ===== L√ìGICA PRINCIPAL DE ENVIO COM MODAL =====
  document.getElementById('feedbackForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (enviando) return;
    
    if (!usuarioLogado) {
      mostrarErroSessao();
      return;
    }
    
    if (isSignatureEmpty()) {
      mostrarErroAssinatura();
      return;
    }
    
    preencherModalConfirmacao();
    mostrarModal();
  });

  // ===== EVENTOS DO MODAL =====
  document.getElementById('btnCancelar').addEventListener('click', function() {
    esconderModal();
    setTimeout(() => {
      document.getElementById('gestor').focus();
    }, 300);
  });

  document.getElementById('btnConfirmar').addEventListener('click', async function() {
    // Verificar novamente a assinatura
    if (isSignatureEmpty()) {
      Swal.fire({
        icon: 'warning',
        title: 'Assinatura Pendente',
        text: 'Por favor, solicite ao colaborador que assine antes de enviar.',
        confirmButtonColor: '#ff6f00'
      });
      esconderModal();
      return;
    }
    
    esconderModal();
    await enviarFeedback();
  });

  // ===== FUN√á√ÉO DE ENVIO REAL =====
  async function enviarFeedback() {
    if (enviando || !usuarioLogado || isSignatureEmpty()) return;
    
    enviando = true;
    iniciarEnvio();
    
    try {
      const formData = {
        gestor: document.getElementById('gestor').value,
        colaborador: document.getElementById('colaborador').value,
        tipo: document.getElementById('tipo').value,
        endereco: document.getElementById('endereco').value,
        enderecoTratado: document.getElementById('enderecoTratado').value,
        nota: document.getElementById('nota').value,
        mensagem: document.getElementById('mensagem').value,
        assinatura: getSignatureDataURL(),
        usuario: usuarioLogado.email
      };
      
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(formData)
      });
      
      if (!response.ok) {
        throw new Error(`Erro ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      
      if (data.result === "success") {
        sucessoEnvio();
      } else {
        throw new Error(data.error || "Erro desconhecido");
      }
    } catch (error) {
      erroEnvio(error);
    } finally {
      enviando = false;
    }
  }

  // ===== FUN√á√ïES AUXILIARES DO ENVIO =====
  function iniciarEnvio() {
    const btn = document.getElementById('btnEnviar');
    const loader = document.getElementById('loader');
    
    btn.disabled = true;
    loader.style.display = "block";
  }

  function finalizarEnvio() {
    const btn = document.getElementById('btnEnviar');
    const loader = document.getElementById('loader');
    
    loader.style.display = "none";
    btn.disabled = false;
  }

  function sucessoEnvio() {
    const btn = document.getElementById('btnEnviar');
    
    btn.innerHTML = '<i class="fas fa-check"></i> Enviado com Sucesso!';
    btn.style.background = 'linear-gradient(135deg, #4caf50, #66bb6a)';
    
    Swal.fire({
      icon: 'success',
      title: 'Feedback Registrado!',
      text: 'O feedback foi salvo no sistema com sucesso.',
      confirmButtonColor: '#4caf50',
      confirmButtonText: 'OK'
    });
    
    setTimeout(() => {
      limparFormulario();
      btn.innerHTML = '<i class="fas fa-paper-plane"></i> Registrar Feedback';
      btn.style.background = '';
      finalizarEnvio();
    }, 2000);
  }

  function erroEnvio(error) {
    console.error('Erro ao enviar:', error);
    
    Swal.fire({
      icon: 'error',
      title: 'Erro ao Enviar',
      html: `<div style="text-align: left;">
              <p>${error.message || 'Ocorreu um erro ao enviar o feedback.'}</p>
              <p style="font-size: 12px; color: #666; margin-top: 10px;">
                <i class="fas fa-lightbulb"></i> Dica: Verifique sua conex√£o e tente novamente.
              </p>
            </div>`,
      confirmButtonColor: '#e53935',
      confirmButtonText: 'Entendi'
    });
    
    finalizarEnvio();
  }

  function limparFormulario() {
    document.getElementById('feedbackForm').reset();
    clearSignature();
    updateNotaDisplay(5);
    document.getElementById('colaborador').disabled = false;
  }

  function mostrarErroSessao() {
    Swal.fire({
      icon: 'error',
      title: 'Sess√£o Expirada',
      text: 'Fa√ßa login novamente.',
      confirmButtonColor: '#e53935'
    });
    sessionStorage.removeItem('feedback_usuario');
    location.reload();
  }

  function mostrarErroAssinatura() {
    const signatureContainer = document.querySelector('.signature-container');
    signatureContainer.style.borderColor = '#e53935';
    signatureContainer.style.background = 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)';
    signatureContainer.style.animation = 'shake 0.5s';
    
    setTimeout(() => {
      signatureContainer.style.borderColor = '';
      signatureContainer.style.background = '';
      signatureContainer.style.animation = '';
    }, 2000);
    
    Swal.fire({
      icon: 'warning',
      title: 'Assinatura Requerida',
      text: 'Por favor, solicite ao colaborador que assine antes de enviar.',
      confirmButtonColor: '#ff6f00'
    });
  }

  // ===== FUN√á√ÉO PARA ALTERNAR VISUALIZA√á√ÉO =====
  function alternarVisualizacao() {
    const toggleBtn = document.getElementById('toggleViewBtn');
    const isMobile = window.innerWidth < 768;
    
    if (isMobile) {
      // Em mobile, alterna entre mostrar/ocultar descri√ß√£o
      document.querySelectorAll('.feedback-card').forEach(card => {
        const messagePreview = card.querySelector('.message-preview');
        if (messagePreview) {
          messagePreview.style.display = messagePreview.style.display === 'none' ? '-webkit-box' : 'none';
        }
      });
      
      toggleBtn.innerHTML = `<i class="fas fa-${messagePreview.style.display === 'none' ? 'eye' : 'eye-slash'}"></i> ${messagePreview.style.display === 'none' ? 'Ver' : 'Ocultar'} Detalhes`;
    } else {
      // Em desktop, alterna entre cards e tabela
      visualizacaoAtual = visualizacaoAtual === 'cards' ? 'tabela' : 'cards';
      
      if (visualizacaoAtual === 'cards') {
        document.querySelector('.feedbacks-table-container').style.display = 'none';
        document.getElementById('feedbacksCards').style.display = 'flex';
        toggleBtn.innerHTML = '<i class="fas fa-table"></i> Tabela';
      } else {
        document.querySelector('.feedbacks-table-container').style.display = 'block';
        document.getElementById('feedbacksCards').style.display = 'none';
        toggleBtn.innerHTML = '<i class="fas fa-th-list"></i> Cards';
      }
    }
  }

  // ===== FUN√á√ïES PARA MEUS FEEDBACKS =====
  async function carregarMeusFeedbacks() {
    if (!usuarioLogado) {
      Swal.fire({
        icon: 'error',
        title: 'Acesso Restrito',
        text: 'Voc√™ precisa estar logado para ver seus feedbacks.',
        confirmButtonColor: '#e53935'
      });
      return;
    }
    
    const feedbacksCards = document.getElementById('feedbacksCards');
    const feedbacksTableBody = document.getElementById('feedbacksTableBody');
    
    feedbacksCards.innerHTML = `
      <div style="text-align: center; padding: 30px;">
        <div class="loader" style="display: block;">
          <i class="fas fa-circle-notch"></i>
          Carregando seus feedbacks...
        </div>
      </div>
    `;
    
    feedbacksTableBody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align: center; padding: 30px;">
          <div class="loader" style="display: block;">
            <i class="fas fa-circle-notch"></i>
            Carregando seus feedbacks...
          </div>
        </td>
      </tr>
    `;
    
    try {
      const response = await fetch(SCRIPT_URL + "?getMeusFeedbacks=" + encodeURIComponent(usuarioLogado.email));
      
      if (!response.ok) {
        throw new Error(`Erro ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      
      if (data.result === "success" && data.feedbacks && data.feedbacks.length > 0) {
        meusFeedbacks = data.feedbacks;
        renderizarFeedbacksMobile();
        renderizarFeedbacksDesktop();
      } else {
        mostrarFeedbacksVazios();
      }
    } catch (error) {
      console.error('Erro ao carregar feedbacks:', error);
      mostrarErroFeedbacks(error);
    }
  }

  function renderizarFeedbacksMobile() {
    const startIndex = (currentFeedbacksPage - 1) * feedbacksPerPage;
    const endIndex = Math.min(startIndex + feedbacksPerPage, meusFeedbacks.length);
    const pageFeedbacks = meusFeedbacks.slice(startIndex, endIndex);
    const totalPages = Math.ceil(meusFeedbacks.length / feedbacksPerPage);
    
    let feedbacksHTML = '';
    
    pageFeedbacks.forEach((feedback, index) => {
      const globalIndex = startIndex + index;
      const dataFormatada = new Date(feedback.data).toLocaleDateString('pt-BR');
      const horaFormatada = new Date(feedback.data).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      
      // Extrair apenas o nome do colaborador (remover matr√≠cula)
      let colaboradorNome = feedback.colaborador;
      if (feedback.colaborador && feedback.colaborador.includes('-')) {
        const parts = feedback.colaborador.split('-');
        if (parts.length > 1) {
          colaboradorNome = parts.slice(1).join('-').trim();
        }
      }
      
      feedbacksHTML += `
        <div class="feedback-card">
          <div class="feedback-header">
            <div>
              <div class="feedback-date">${dataFormatada}</div>
              <div class="feedback-time">${horaFormatada}</div>
            </div>
            <div class="feedback-number">#${globalIndex + 1}</div>
          </div>
          
          <div class="feedback-info-grid">
            <div class="info-item">
              <div class="info-label">Colaborador</div>
              <div class="info-value">${colaboradorNome}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Tipo</div>
              <div>
                <span class="feedback-badge" style="background: ${getCorPorTipo(feedback.tipo)};">
                  ${feedback.tipo}
                </span>
              </div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Nota</div>
              <div>
                <span class="nota-display-small" style="background: ${getCorPorNotaCSS(feedback.nota)};">
                  ${feedback.nota}/10
                </span>
              </div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Endere√ßo WMS</div>
              <div class="info-value">${feedback.endereco || 'N/A'}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Status</div>
              <div>
                <span class="status-badge" style="background: ${getCorPorStatus(feedback.status)};">
                  ${feedback.status || 'N/A'}
                </span>
              </div>
            </div>
          </div>
          
          <div class="feedback-message">
            <div class="info-label">Descri√ß√£o</div>
            <div class="message-preview">
              ${feedback.mensagem || 'Sem descri√ß√£o'}
            </div>
          </div>
        </div>
      `;
    });
    
    document.getElementById('feedbacksCards').innerHTML = feedbacksHTML;
    renderizarPaginacao(totalPages);
  }

  function renderizarFeedbacksDesktop() {
    const startIndex = (currentFeedbacksPage - 1) * feedbacksPerPage;
    const endIndex = Math.min(startIndex + feedbacksPerPage, meusFeedbacks.length);
    const pageFeedbacks = meusFeedbacks.slice(startIndex, endIndex);
    
    let tableHTML = '';
    
    pageFeedbacks.forEach((feedback) => {
      const dataFormatada = new Date(feedback.data).toLocaleDateString('pt-BR');
      const horaFormatada = new Date(feedback.data).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      
      // Extrair apenas o nome do colaborador (remover matr√≠cula)
      let colaboradorNome = feedback.colaborador;
      if (feedback.colaborador && feedback.colaborador.includes('-')) {
        const parts = feedback.colaborador.split('-');
        if (parts.length > 1) {
          colaboradorNome = parts.slice(1).join('-').trim();
        }
      }
      
      tableHTML += `
        <tr>
          <td>
            <div style="font-weight: 500;">${dataFormatada}</div>
            <div style="font-size: 12px; color: var(--text-light);">${horaFormatada}</div>
          </td>
          <td>${colaboradorNome}</td>
          <td>
            <span class="feedback-badge" style="background: ${getCorPorTipo(feedback.tipo)};">
              ${feedback.tipo}
            </span>
          </td>
          <td>
            <span class="nota-display-small" style="background: ${getCorPorNotaCSS(feedback.nota)};">
              ${feedback.nota}/10
            </span>
          </td>
          <td>${feedback.endereco || 'N/A'}</td>
          <td>
            <span class="status-badge" style="background: ${getCorPorStatus(feedback.status)};">
              ${feedback.status || 'N/A'}
            </span>
          </td>
        </tr>
      `;
    });
    
    document.getElementById('feedbacksTableBody').innerHTML = tableHTML;
  }

  function mostrarFeedbacksVazios() {
    const feedbacksCards = document.getElementById('feedbacksCards');
    const feedbacksTableBody = document.getElementById('feedbacksTableBody');
    
    feedbacksCards.innerHTML = `
      <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
        <i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0;"></i>
        <h4 style="margin-bottom: 10px; color: var(--text-light);">Nenhum feedback encontrado</h4>
        <p style="font-size: 14px; margin-bottom: 20px;">Voc√™ ainda n√£o registrou nenhum feedback no sistema.</p>
        <button class="btn-submit" onclick="document.querySelector('[data-page=\\'feedback\\']').click()" style="max-width: 250px; margin: 0 auto;">
          <i class="fas fa-plus-circle"></i>
          Registrar Primeiro Feedback
        </button>
      </div>
    `;
    
    feedbacksTableBody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-light);">
          <i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0; display: block;"></i>
          <h4 style="margin-bottom: 10px; color: var(--text-light);">Nenhum feedback encontrado</h4>
          <p style="font-size: 14px;">Voc√™ ainda n√£o registrou nenhum feedback no sistema.</p>
        </td>
      </tr>
    `;
    
    document.getElementById('paginationControls').style.display = 'none';
  }

  function mostrarErroFeedbacks(error) {
    const feedbacksCards = document.getElementById('feedbacksCards');
    const feedbacksTableBody = document.getElementById('feedbacksTableBody');
    
    feedbacksCards.innerHTML = `
      <div style="text-align: center; padding: 40px 20px; color: var(--shoppe-red);">
        <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 15px;"></i>
        <h4 style="margin-bottom: 10px; color: var(--shoppe-red);">Erro ao carregar feedbacks</h4>
        <p style="font-size: 14px; margin-bottom: 20px;">${error.message || 'N√£o foi poss√≠vel carregar seus feedbacks.'}</p>
        <button class="btn-submit" onclick="carregarMeusFeedbacks()" style="max-width: 200px; margin: 0 auto;">
          <i class="fas fa-redo"></i>
          Tentar Novamente
        </button>
      </div>
    `;
    
    feedbacksTableBody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align: center; padding: 40px; color: var(--shoppe-red);">
          <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 15px; display: block;"></i>
          <h4 style="margin-bottom: 10px; color: var(--shoppe-red);">Erro ao carregar feedbacks</h4>
          <p style="font-size: 14px;">${error.message || 'N√£o foi poss√≠vel carregar seus feedbacks.'}</p>
        </td>
      </tr>
    `;
    
    document.getElementById('paginationControls').style.display = 'none';
  }

  function renderizarPaginacao(totalPages) {
    const paginationControls = document.getElementById('paginationControls');
    
    if (totalPages <= 1) {
      paginationControls.style.display = 'none';
      return;
    }
    
    let paginationHTML = `
      <div class="pagination-info">
        Mostrando ${(currentFeedbacksPage - 1) * feedbacksPerPage + 1} - ${Math.min(currentFeedbacksPage * feedbacksPerPage, meusFeedbacks.length)} de ${meusFeedbacks.length} feedbacks
      </div>
      
      <div class="pagination-controls">
        <div class="items-per-page">
          <span>Itens por p√°gina:</span>
          <select id="itemsPerPageSelect" onchange="mudarItensPorPagina(this.value)">
            <option value="5" ${feedbacksPerPage === 5 ? 'selected' : ''}>5</option>
            <option value="10" ${feedbacksPerPage === 10 ? 'selected' : ''}>10</option>
            <option value="15" ${feedbacksPerPage === 15 ? 'selected' : ''}>15</option>
            <option value="20" ${feedbacksPerPage === 20 ? 'selected' : ''}>20</option>
            <option value="25" ${feedbacksPerPage === 25 ? 'selected' : ''}>25</option>
          </select>
        </div>
        
        <div class="pagination-buttons">
          <button class="pagination-button" onclick="mudarPagina(1)" ${currentFeedbacksPage === 1 ? 'disabled' : ''}>
            <i class="fas fa-angle-double-left"></i>
          </button>
          <button class="pagination-button" onclick="mudarPagina(${currentFeedbacksPage - 1})" ${currentFeedbacksPage === 1 ? 'disabled' : ''}>
            <i class="fas fa-angle-left"></i>
          </button>
          
          <div class="page-numbers">
    `;
    
    // Gerar n√∫meros de p√°gina
    const maxVisiblePages = window.innerWidth < 480 ? 3 : 5;
    let startPage = Math.max(1, currentFeedbacksPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    if (startPage > 1) {
      paginationHTML += `<span class="page-number" onclick="mudarPagina(1)">1</span>`;
      if (startPage > 2) {
        paginationHTML += `<span class="page-ellipsis">...</span>`;
      }
    }
    
    for (let i = startPage; i <= endPage; i++) {
      paginationHTML += `<span class="page-number ${i === currentFeedbacksPage ? 'active' : ''}" onclick="mudarPagina(${i})">${i}</span>`;
    }
    
    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        paginationHTML += `<span class="page-ellipsis">...</span>`;
      }
      paginationHTML += `<span class="page-number" onclick="mudarPagina(${totalPages})">${totalPages}</span>`;
    }
    
    paginationHTML += `
          </div>
          
          <button class="pagination-button" onclick="mudarPagina(${currentFeedbacksPage + 1})" ${currentFeedbacksPage === totalPages ? 'disabled' : ''}>
            <i class="fas fa-angle-right"></i>
          </button>
          <button class="pagination-button" onclick="mudarPagina(${totalPages})" ${currentFeedbacksPage === totalPages ? 'disabled' : ''}>
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
      </div>
    `;
    
    paginationControls.innerHTML = paginationHTML;
    paginationControls.style.display = 'flex';
  }

  function mudarPagina(pagina) {
    if (pagina >= 1 && pagina <= Math.ceil(meusFeedbacks.length / feedbacksPerPage)) {
      currentFeedbacksPage = pagina;
      renderizarFeedbacksMobile();
      renderizarFeedbacksDesktop();
      // Scroll para o topo
      document.querySelector('.feedbacks-container').scrollIntoView({ behavior: 'smooth' });
    }
  }

  function mudarItensPorPagina(valor) {
    feedbacksPerPage = parseInt(valor);
    currentFeedbacksPage = 1;
    renderizarFeedbacksMobile();
    renderizarFeedbacksDesktop();
  }

  // ===== FUN√á√ïES PARA RELAT√ìRIOS =====
  async function gerarRelatorios() {
    if (!usuarioLogado) return;
    
    const chartsGrid = document.getElementById('chartsGrid');
    chartsGrid.innerHTML = `
      <div style="text-align: center; padding: 30px; grid-column: 1 / -1;">
        <div class="loader" style="display: block;">
          <i class="fas fa-circle-notch"></i>
          Gerando relat√≥rios e gr√°ficos...
        </div>
      </div>
    `;
    
    try {
      const response = await fetch(SCRIPT_URL + "?getMeusFeedbacks=" + encodeURIComponent(usuarioLogado.email));
      
      if (!response.ok) {
        throw new Error(`Erro ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      
      if (data.result === "success" && data.feedbacks && data.feedbacks.length > 0) {
        meusFeedbacks = data.feedbacks;
        atualizarEstatisticas();
        renderizarGraficos();
      } else {
        chartsGrid.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: var(--text-light); grid-column: 1 / -1;">
            <i class="fas fa-chart-bar" style="font-size: 40px; margin-bottom: 15px; color: #e0e0e0;"></i>
            <h4 style="margin-bottom: 10px; color: var(--text-light);">Dados insuficientes para relat√≥rios</h4>
            <p style="font-size: 14px; margin-bottom: 20px;">Registre alguns feedbacks para gerar estat√≠sticas e gr√°ficos</p>
            <button class="btn-submit" onclick="document.querySelector('[data-page=\\'feedback\\']').click()" style="max-width: 200px; margin: 0 auto;">
              <i class="fas fa-plus-circle"></i>
              Registrar Feedback
            </button>
          </div>
        `;
      }
    } catch (error) {
      console.error('Erro ao carregar relat√≥rios:', error);
      chartsGrid.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: var(--shoppe-red); grid-column: 1 / -1;">
          <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 15px;"></i>
          <h4 style="margin-bottom: 10px; color: var(--shoppe-red);">Erro ao carregar relat√≥rios</h4>
          <p style="font-size: 14px; margin-bottom: 20px;">${error.message || 'N√£o foi poss√≠vel carregar os dados para relat√≥rios.'}</p>
          <button class="btn-submit" onclick="gerarRelatorios()" style="max-width: 200px; margin: 0 auto;">
            <i class="fas fa-redo"></i>
            Tentar Novamente
          </button>
        </div>
      `;
    }
  }

  function atualizarEstatisticas() {
    if (!meusFeedbacks || meusFeedbacks.length === 0) return;
    
    // Total de feedbacks
    document.getElementById('totalFeedbacks').textContent = meusFeedbacks.length;
    
    // Nota m√©dia
    const totalNota = meusFeedbacks.reduce((sum, f) => sum + parseFloat(f.nota || 0), 0);
    const avgNota = (totalNota / meusFeedbacks.length).toFixed(1);
    document.getElementById('avgNota').textContent = avgNota;
    
    // Tipo mais comum
    const tipoCounts = {};
    meusFeedbacks.forEach(f => {
      tipoCounts[f.tipo] = (tipoCounts[f.tipo] || 0) + 1;
    });
    let topTipo = '';
    let maxCount = 0;
    Object.entries(tipoCounts).forEach(([tipo, count]) => {
      if (count > maxCount) {
        maxCount = count;
        topTipo = tipo;
      }
    });
    document.getElementById('topTipo').textContent = topTipo.substring(0, 12) + (topTipo.length > 12 ? '...' : '');
    
    // Taxa de conclus√£o (endere√ßos tratados)
    const concluidos = meusFeedbacks.filter(f => f.status === 'Concluido' || f.status === 'Conclu√≠do').length;
    const completionRate = Math.round((concluidos / meusFeedbacks.length) * 100);
    document.getElementById('completionRate').textContent = `${completionRate}%`;
  }

  function renderizarGraficos() {
    const chartsGrid = document.getElementById('chartsGrid');
    
    // Limpar gr√°ficos existentes
    chartsGrid.innerHTML = '';
    
    // Dados para gr√°ficos
    const tipoCounts = {};
    const notaCounts = {};
    const statusCounts = {};
    const notasPorMes = {};
    
    meusFeedbacks.forEach(feedback => {
      // Contagem por tipo
      tipoCounts[feedback.tipo] = (tipoCounts[feedback.tipo] || 0) + 1;
      
      // Contagem por nota
      const nota = parseInt(feedback.nota);
      notaCounts[nota] = (notaCounts[nota] || 0) + 1;
      
      // Contagem por status
      const status = feedback.status || 'N√£o informado';
      statusCounts[status] = (statusCounts[status] || 0) + 1;
      
      // Notas por m√™s
      const data = new Date(feedback.data);
      const mesAno = `${data.getMonth() + 1}/${data.getFullYear()}`;
      if (!notasPorMes[mesAno]) {
        notasPorMes[mesAno] = { total: 0, count: 0 };
      }
      notasPorMes[mesAno].total += nota;
      notasPorMes[mesAno].count += 1;
    });
    
    // Gr√°fico 1: Distribui√ß√£o por Tipo de Feedback
    const tiposLabels = Object.keys(tipoCounts);
    const tiposData = Object.values(tipoCounts);
    const tiposCores = tiposLabels.map(tipo => getCorPorTipo(tipo));
    
    chartsGrid.innerHTML += `
      <div class="chart-container">
        <div class="chart-header">
          <h4><i class="fas fa-chart-pie"></i> Distribui√ß√£o por Tipo</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartTipos"></canvas>
        </div>
      </div>
    `;
    
    // Gr√°fico 2: Distribui√ß√£o por Nota
    const notasLabels = Object.keys(notaCounts).sort((a, b) => a - b);
    const notasData = notasLabels.map(nota => notaCounts[nota]);
    const notasCores = notasLabels.map(nota => getCorPorNotaCSS(parseInt(nota)));
    
    chartsGrid.innerHTML += `
      <div class="chart-container">
        <div class="chart-header">
          <h4><i class="fas fa-star"></i> Distribui√ß√£o por Nota</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartNotas"></canvas>
        </div>
      </div>
    `;
    
    // Gr√°fico 3: Status dos Endere√ßos
    const statusLabels = Object.keys(statusCounts);
    const statusData = Object.values(statusCounts);
    const statusCores = statusLabels.map(status => getCorPorStatus(status));
    
    chartsGrid.innerHTML += `
      <div class="chart-container">
        <div class="chart-header">
          <h4><i class="fas fa-check-circle"></i> Status dos Endere√ßos</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartStatus"></canvas>
        </div>
      </div>
    `;
    
    // Gr√°fico 4: Evolu√ß√£o da Nota M√©dia por M√™s
    const mesesLabels = Object.keys(notasPorMes).sort((a, b) => {
      const [mesA, anoA] = a.split('/').map(Number);
      const [mesB, anoB] = b.split('/').map(Number);
      return new Date(anoA, mesA - 1) - new Date(anoB, mesB - 1);
    });
    const notasMedias = mesesLabels.map(mes => 
      (notasPorMes[mes].total / notasPorMes[mes].count).toFixed(1)
    );
    
    chartsGrid.innerHTML += `
      <div class="chart-container" style="grid-column: 1 / -1;">
        <div class="chart-header">
          <h4><i class="fas fa-chart-line"></i> Evolu√ß√£o da Nota M√©dia</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartEvolucao"></canvas>
        </div>
      </div>
    `;
    
    // Renderizar gr√°ficos ap√≥s o DOM ser atualizado
    setTimeout(() => {
      // Gr√°fico de pizza - Tipos
      new Chart(document.getElementById('chartTipos'), {
        type: 'pie',
        data: {
          labels: tiposLabels,
          datasets: [{
            data: tiposData,
            backgroundColor: tiposCores,
            borderWidth: 1,
            borderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: window.innerWidth < 768 ? 'bottom' : 'right',
              labels: {
                padding: 15,
                usePointStyle: true,
                font: {
                  size: window.innerWidth < 768 ? 10 : 11
                }
              }
            }
          }
        }
      });
      
      // Gr√°fico de barras - Notas
      new Chart(document.getElementById('chartNotas'), {
        type: 'bar',
        data: {
          labels: notasLabels.map(n => `${n}/10`),
          datasets: [{
            label: 'Quantidade',
            data: notasData,
            backgroundColor: notasCores,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
      
      // Gr√°fico de doughnut - Status
      new Chart(document.getElementById('chartStatus'), {
        type: 'doughnut',
        data: {
          labels: statusLabels,
          datasets: [{
            data: statusData,
            backgroundColor: statusCores,
            borderWidth: 1,
            borderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '50%',
          plugins: {
            legend: {
              position: window.innerWidth < 768 ? 'bottom' : 'right',
              labels: {
                padding: 10,
                usePointStyle: true,
                font: {
                  size: window.innerWidth < 768 ? 10 : 11
                }
              }
            }
          }
        }
      });
      
      // Gr√°fico de linha - Evolu√ß√£o
      new Chart(document.getElementById('chartEvolucao'), {
        type: 'line',
        data: {
          labels: mesesLabels,
          datasets: [{
            label: 'Nota M√©dia',
            data: notasMedias,
            borderColor: '#e53935',
            backgroundColor: 'rgba(229, 57, 53, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true,
            pointBackgroundColor: '#e53935',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: false,
              min: 0,
              max: 10,
              ticks: {
                stepSize: 1
              }
            }
          },
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });
    }, 100);
  }

  // ===== FUN√á√ïES AUXILIARES PARA CORES =====
  function getCorPorTipo(tipo) {
    const cores = {
      'Qualidade Putaway': '#9c27b0',
      'Sugest√£o de Melhoria': '#009688',
      'OB Verdadeiro - PNE': '#795548',
      'OB Verdadeiro - PE': '#795548',
      'OB Falso': '#757575',
      'Elogio': '#4caf50',
      'Orienta√ß√£o': '#2196f3',
      'Comportamental': '#ff6f00',
      'PDI': '#e53935',
      'Melhoria': '#ffc107'
    };
    return cores[tipo] || '#757575';
  }

  function getCorPorNotaCSS(nota) {
    if (nota <= 3) return '#e53935';
    if (nota <= 5) return '#ff6f00';
    if (nota <= 7) return '#ff9800';
    if (nota <= 9) return '#ffab00';
    return '#ffc400';
  }

  function getCorPorStatus(status) {
    if (status === 'Concluido' || status === 'Conclu√≠do') return '#4caf50';
    if (status === 'Pendente') return '#ff6f00';
    if (status === 'NA') return '#757575';
    return '#9e9e9e';
  }

  // ===== FUN√á√ÉO PARA EXPORTAR PDF =====
  async function exportarFeedbacksPDF() {
    if (!meusFeedbacks || meusFeedbacks.length === 0) {
      Swal.fire({
        icon: 'info',
        title: 'Nada para Exportar',
        text: 'N√£o h√° feedbacks para exportar. Carregue seus feedbacks primeiro.',
        confirmButtonColor: '#2196f3'
      });
      return;
    }
    
    const loadingSwal = Swal.fire({
      title: 'Gerando PDF...',
      html: '<div class="loader" style="margin: 20px 0;"><i class="fas fa-circle-notch fa-spin"></i> Preparando documento...</div>',
      showConfirmButton: false,
      allowOutsideClick: false
    });
    
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });
      
      const pageWidth = doc.internal.pageSize.width;
      const margin = 15;
      const contentWidth = pageWidth - (margin * 2);
      
      // Cabe√ßalho
      doc.setFontSize(18);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(229, 57, 53);
      doc.text('RELAT√ìRIO DE FEEDBACKS', pageWidth / 2, margin, { align: 'center' });
      
      // Informa√ß√µes
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(100, 100, 100);
      doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, margin, margin + 8);
      doc.text(`Usu√°rio: ${usuarioLogado.nome}`, margin, margin + 13);
      doc.text(`Total de feedbacks: ${meusFeedbacks.length}`, pageWidth - margin, margin + 8, { align: 'right' });
      
      // Linha divis√≥ria
      doc.setDrawColor(229, 57, 53);
      doc.setLineWidth(0.5);
      doc.line(margin, margin + 18, pageWidth - margin, margin + 18);
      
      let yPosition = margin + 25;
      
      // Adicionar cada feedback
      meusFeedbacks.forEach((feedback, index) => {
        if (yPosition > doc.internal.pageSize.height - 30) {
          doc.addPage();
          yPosition = margin;
        }
        
        const dataFormatada = new Date(feedback.data).toLocaleDateString('pt-BR');
        const horaFormatada = new Date(feedback.data).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        
        // T√≠tulo do feedback
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(33, 33, 33);
        doc.text(`Feedback #${index + 1}`, margin, yPosition);
        
        // Data e hora
        doc.setFontSize(8);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(100, 100, 100);
        doc.text(`${dataFormatada} ${horaFormatada}`, pageWidth - margin, yPosition, { align: 'right' });
        
        yPosition += 7;
        
        // Informa√ß√µes
        doc.setFontSize(9);
        doc.setFont('helvetica', 'bold');
        doc.text('Colaborador:', margin, yPosition);
        doc.setFont('helvetica', 'normal');
        
        // Extrair nome do colaborador
        let colaboradorNome = feedback.colaborador;
        if (feedback.colaborador && feedback.colaborador.includes('-')) {
          const parts = feedback.colaborador.split('-');
          if (parts.length > 1) {
            colaboradorNome = parts.slice(1).join('-').trim();
          }
        }
        
        const colaboradorTexto = doc.splitTextToSize(colaboradorNome, contentWidth / 2);
        doc.text(colaboradorTexto, margin + 20, yPosition);
        
        doc.setFont('helvetica', 'bold');
        doc.text('Tipo:', margin + contentWidth / 2, yPosition);
        doc.setFont('helvetica', 'normal');
        doc.text(feedback.tipo, margin + contentWidth / 2 + 12, yPosition);
        
        yPosition += 6;
        
        doc.setFont('helvetica', 'bold');
        doc.text('Endere√ßo WMS:', margin, yPosition);
        doc.setFont('helvetica', 'normal');
        doc.text(feedback.endereco || 'N/A', margin + 28, yPosition);
        
        doc.setFont('helvetica', 'bold');
        doc.text('Status:', margin + contentWidth / 2, yPosition);
        doc.setFont('helvetica', 'normal');
        doc.text(feedback.status || 'N/A', margin + contentWidth / 2 + 15, yPosition);
        
        yPosition += 6;
        
        doc.setFont('helvetica', 'bold');
        doc.text('Nota:', margin, yPosition);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(229, 57, 53);
        doc.text(`${feedback.nota}/10`, margin + 15, yPosition);
        
        yPosition += 6;
        
        // Descri√ß√£o (limitada)
        let descricao = feedback.mensagem || 'Sem descri√ß√£o';
        if (descricao.length > 80) {
          descricao = descricao.substring(0, 80) + '...';
        }
        
        doc.setFontSize(8);
        doc.setFont('helvetica', 'italic');
        doc.setTextColor(100, 100, 100);
        
        const descricaoLines = doc.splitTextToSize(descricao, contentWidth - 10);
        doc.text(descricaoLines, margin + 5, yPosition);
        
        yPosition += descricaoLines.length * 4 + 10;
        
        // Linha separadora
        doc.setDrawColor(224, 224, 224);
        doc.setLineWidth(0.2);
        doc.line(margin, yPosition - 5, pageWidth - margin, yPosition - 5);
      });
      
      // Rodap√©
      const totalPages = doc.internal.getNumberOfPages();
      for (let i = 1; i <= totalPages; i++) {
        doc.setPage(i);
        doc.setFontSize(7);
        doc.setTextColor(150, 150, 150);
        doc.text(
          `P√°gina ${i} de ${totalPages}`,
          pageWidth / 2,
          doc.internal.pageSize.height - 10,
          { align: 'center' }
        );
      }
      
      loadingSwal.close();
      
      const fileName = `feedbacks_${usuarioLogado.nome.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
      doc.save(fileName);
      
      Swal.fire({
        icon: 'success',
        title: 'PDF Gerado!',
        html: `<div style="text-align: left; padding: 10px;">
                <p><strong>Arquivo:</strong> ${fileName}</p>
                <p><strong>Total de feedbacks:</strong> ${meusFeedbacks.length}</p>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                  <i class="fas fa-info-circle"></i> O arquivo foi baixado automaticamente.
                </p>
              </div>`,
        confirmButtonColor: '#4caf50'
      });
      
    } catch (error) {
      console.error('Erro ao gerar PDF:', error);
      loadingSwal.close();
      
      Swal.fire({
        icon: 'error',
        title: 'Erro ao Gerar PDF',
        text: 'Ocorreu um erro ao gerar o arquivo PDF. Tente novamente.',
        confirmButtonColor: '#e53935'
      });
    }
  }

  // ===== EVENTOS ADICIONAIS =====
  document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('confirmationModal');
    if (e.key === 'Escape') {
      if (modal.style.display === 'flex') {
        esconderModal();
      }
    }
  });

  document.getElementById('confirmationModal').addEventListener('click', function(e) {
    if (e.target === this) {
      esconderModal();
    }
  });

  // Placeholder din√¢mico para gestor
  document.getElementById('gestor').addEventListener('focus', function() {
    if (usuarioLogado && !this.value) {
      this.placeholder = `Ex: ${usuarioLogado.nome} (se for voc√™)`;
    }
  });
  
  document.getElementById('gestor').addEventListener('blur', function() {
    this.placeholder = "Quem est√° aplicando o feedback?";
  });
</script>
</body>
</html>
</html>
